<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Detection with Webcam.js and face-api.js</title>
    <!-- Include Webcam.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webcamjs/1.0.26/webcam.min.js"></script>
    <!-- Include face-api.js library -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.23.0"></script>
</head>
<body>

<!-- Limited area for face detection -->
<canvas id="limitedArea" width="640" height="480" style="border: 2px solid #333;"></canvas>

<!-- Initialize Webcam.js -->
<script>
    Webcam.set({
        width: 640,
        height: 480,
        image_format: 'jpeg',
        jpeg_quality: 90
    });

    Webcam.attach('#limitedArea');
</script>

<!-- Load face-api.js and perform face detection -->
<script>
    // Load face-api.js models from GitHub
    Promise.all([
        faceapi.nets.tinyFaceDetector.loadFromUri('https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights'),
        faceapi.nets.faceLandmark68Net.loadFromUri('https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights'),
        faceapi.nets.faceRecognitionNet.loadFromUri('https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights'),
    ]).then(startFaceDetection);

    // Start face detection
    function startFaceDetection() {
        // Get limited area canvas
        const limitedAreaCanvas = document.getElementById('limitedArea');

        // Detect faces within the limited area
        Webcam.snap((data_uri) => {
            faceapi.detectSingleFace(data_uri, new faceapi.TinyFaceDetectorOptions())
                .withFaceLandmarks()
                .then((result) => {
                    if (result) {
                        // Draw the limited area canvas
                        const context = limitedAreaCanvas.getContext('2d');
                        context.clearRect(0, 0, limitedAreaCanvas.width, limitedAreaCanvas.height);
                        context.drawImage(result.image, result.detection.box.x, result.detection.box.y, result.detection.box.width, result.detection.box.height, 0, 0, limitedAreaCanvas.width, limitedAreaCanvas.height);

                        // Draw face landmarks
                        faceapi.draw.drawFaceLandmarks(limitedAreaCanvas, result);
                    }
                });
        });
    }
</script>

</body>
</html>
